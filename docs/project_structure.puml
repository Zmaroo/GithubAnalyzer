@startuml github_analyzer_architecture

' Styling
skinparam componentStyle uml2
skinparam backgroundColor white
skinparam monochrome true

package "GithubAnalyzer" {
    ' Core Layer
    package "Core" {
        package "Models" {
            component [errors.py] as EM
            component [file.py] as FM
            component [ast.py] as AST
            
            note right of EM
                Error Hierarchy:
                ParserError
                ├── LanguageError
                └── QueryError
                FileOperationError
                EditError
            end note

            note right of AST
                ParseResult:
                - tree: Tree
                - language: str
                - content: str
                - is_code: bool
                - metadata: Dict
            end note

            note right of FM
                FileInfo:
                - path: Path
                - language: str
                - metadata: Dict
                FileFilterConfig:
                - include_patterns
                - exclude_patterns
                - languages
                - ignore_binary
            end note
        }
        
        package "Services" {
            component [file_service.py] as FS
            component [parser_service.py] as PS
        }

        package "Config" {
            component [settings.py] as SET
            component [logging_config.py] as LOG
        }

        package "Utils" {
            component [logging.py] as LG
            component [timing.py] as TM
            component [error_handler.py] as EH
            component [file_utils.py] as FU
        }
    }

    ' Analysis Layer
    package "Analysis" {
        package "Models" {
            component [code_analysis.py] as CAM
            component [results.py] as RES
            component [tree_sitter.py] as TSM
            component [edit_operation.py] as EO
        }
        
        package "Services" {
            package "Parsers" {
                component [tree_sitter_query.py] as TSQ
                component [tree_sitter_traversal.py] as TST
                component [query_patterns.py] as QP
                component [tree_sitter_editor.py] as TSE
                component [tree_sitter_logging.py] as TSL
                component [tree_sitter_visualizer.py] as TSV
            }
            
            package "Analysis" {
                component [code_analyzer.py] as CA
                component [metrics_collector.py] as MC
            }
        }
    }

    ' Core Dependencies
    FS --> FM : uses file models
    PS --> AST : uses AST models
    PS --> "tree-sitter-language-pack" : uses directly
    PS --> FM : uses FileInfo
    FS --> LOG : uses logging config
    EH --> EM : handles errors
    FS --> FU : uses file utils

    ' Analysis Dependencies
    TSQ --> "tree-sitter-language-pack" : uses directly
    TSQ --> TST : uses traversal
    TSQ --> QP : uses patterns
    TSM --> AST : extends models
    CAM --> RES : uses results
    TSQ --> TSM : uses models
    TSE --> TST : uses traversal
    TSE --> TSQ : uses query handler
    TSE --> TSL : uses logging
    TSE --> TSV : uses visualizer
    TSE --> "tree-sitter-language-pack" : uses directly
    TSQ --> TSL : uses logging
    TST --> TSL : uses logging
    CA --> MC : uses metrics
    CA --> TSE : uses editor
    CA --> TSQ : uses queries

    ' Error Usage
    FS ..> EM : throws FileOperationError
    PS ..> EM : throws ParserError, LanguageError
    TSQ ..> EM : throws QueryError
    TSE ..> EM : throws ParserError, EditError

    ' Utility Usage
    FS --> LG : uses logging
    PS --> LG : uses logging
    TSQ --> LG : uses logging
    TSE --> LG : uses logging
    PS ..> TM : uses timing
    TSQ ..> TM : uses timing
    FS ..> EH : uses error handler
    PS ..> EH : uses error handler

    note right of Core
        Core layer provides:
        - File operations and utilities
        - Direct tree-sitter integration
        - Configuration management
        - Error handling
        - Logging and timing utilities
    end note

    note right of Analysis
        Analysis layer provides:
        - Code analysis models
        - Tree-sitter query and traversal
        - Tree editing and validation
        - Incremental parsing
        - Specialized logging
        - Code metrics collection
    end note

    note right of PS
        ParserService features:
        - Direct tree-sitter integration
        - Language detection
        - Syntax error handling
        - File type detection
        - Timeout support
        - Binary file handling
        - Incremental parsing
    end note

    note right of FS
        FileService features:
        - File listing and filtering
        - Language detection
        - File metadata collection
        - Binary file detection
        - Error handling
        - File system operations
    end note

    note right of TSE
        TreeSitterEditor features:
        - Incremental parsing
        - Tree editing with validation
        - Position validation
        - Tree change verification
        - Error and missing node detection
        - Source byte handling
        - Tree visualization
    end note

    note right of TSQ
        TreeSitterQueryHandler features:
        - Query pattern management
        - Node finding and validation
        - Syntax error detection
        - Missing node detection
        - Query optimization
        - Pattern caching
    end note

    note right of TST
        TreeSitterTraversal features:
        - Tree traversal utilities
        - Node finding by type/text
        - Node relationship checks
        - Tree structure validation
        - Node range calculations
        - Path navigation
    end note

    note right of CA
        CodeAnalyzer features:
        - Code metrics collection
        - Pattern detection
        - AST analysis
        - Code quality checks
        - Dependency analysis
    end note
}

@enduml 